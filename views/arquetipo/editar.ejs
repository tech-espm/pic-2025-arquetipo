<div class="row">

	<input type="hidden" id="id" name="id" value="<%=(item ? item.id : 0) %>" />

	<div class="col-md-6">
		<div class="form-group">
			<label for="nome">Nome</label>
			<input id="nome" name="nome" maxlength="100" class="form-control" type="text" spellcheck="false"
				value="<%=(item ? item.nome : '') %>" />
		</div>

	</div>

	<div class="col-md-6">

		<div class="form-group">
			<label for="nomeexterno">Nome externo</label>
			<input id="nomeexterno" name="nomeexterno" maxlength="100" class="form-control" type="text"
				spellcheck="false" value="<%=(item ? item.nomeexterno : '') %>" />
		</div>
	</div>

	<div class="col-md-12">
		<div class="form-group">
			<input type="hidden" id="iddepartamento" name="iddepartamento" />
			<label for="iddepartamentoselect">Departamento</label>
			<select id="iddepartamentoselect" class="form-control" size="1">
				<% for (let i=0; i < departamentos.length; i++) { %>
					<option value="<%= departamentos[i].id %>">
						<%= departamentos[i].nome %>
					</option>
					<% } %>
			</select>
		</div>
	</div>

	<div class="col-12">

		<div class="form-group">
			<label for="descricaocurta">Descrição curta</label>
			<input id="descricaocurta" name="descricaocurta" maxlength="255" class="form-control" type="text"
				spellcheck="false" value="<%=(item ? item.descricaocurta : '') %>" />
		</div>
	</div>

	<div class="col-12">
		<div class="form-group">
			<label for="descricaocompleta">Descrição completa</label>
			<textarea id="descricaocompleta" name="descricaocompleta" class="form-control"><%=(item ? item.descricaocompleta : '') %></textarea>
		</div>
	</div>

</div>
<%- contentFor("scripts") %>
	<script type="text/javascript">
		//<![CDATA[
		"use strict";

		
	prepareMultiselect("#iddepartamentoselect", { title: "Departamento", label: "Departamento" });

	//<% if (item) { %>
	setMultiselectSelection("#iddepartamentoselect", [<%- item.iddepartamento.map(d => d.iddepartamento).join(",") %>]);
	//<% } %>

		$("#form").validate({
			rules: {
				nome: {
					required: true
				},
				nomeexterno: {
					required: true,
				},
				iddepartamento: {
					required: true,
				},
				descricaocurta: {
					required: true,
				},
				descricaocompleta: {
					required: true,
				}

			},

			submitHandler: function (form) {
				if (JsonWebApi.active)
					return;

				Swal.wait();

				$("#iddepartamento").val(getMultiselectSelection("#iddepartamentoselect").join(","));

				//<% if (item) { %>

				JsonWebApi.postFormData("<%- root %>/api/arquetipo/editar", form, function (response) {
					if (response.success)
						Swal.success("Arquetipo alterado com sucesso! " + emoji.happy);
					else
						Swal.error(response.value + " " + emoji.sad);
				});

				//<% } else { %>

				JsonWebApi.postFormData("<%- root %>/api/arquetipo/criar", form, function (response) {
					if (response.success) {
						let nome = $("#nome").val();
						resetForm("#form");
						Swal.success("Arquetipo criado com sucesso! " + emoji.happy).then(() => {
							JsonWebApi.redirect("<%- root %>/arquetipo/editar?nome=" + encodeURIComponent(nome));
						});
					} else {
						Swal.error(response.value + " " + emoji.sad);
					}
				});

				//<% } %>
			}
		});
		//]]>
	</script>